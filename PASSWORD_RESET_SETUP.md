# Настройка функциональности сброса пароля

В этом документе описывается, как настроить и использовать функциональность сброса пароля в приложении LegalGPT.

## Настройка отправки электронной почты

Для отправки электронных писем с инструкциями по сбросу пароля используется SMTP-сервер Gmail. Для настройки выполните следующие шаги:

### 1. Создание пароля приложения в Google

1. Войдите в свою учетную запись Google
2. Перейдите в раздел "Безопасность" (https://myaccount.google.com/security)
3. Включите двухфакторную аутентификацию, если она еще не включена
4. Перейдите в раздел "Пароли приложений" (https://myaccount.google.com/apppasswords)
5. Создайте новый пароль приложения:
   - Выберите приложение: "Другое (указать название)"
   - Введите название: "LegalGPT"
   - Нажмите "Создать"
6. Скопируйте сгенерированный пароль (16 символов без пробелов)

### 2. Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта и добавьте следующую строку:

```
EMAIL_APP_PASSWORD=ваш-пароль-приложения
EMAIL_USERNAME=ваш-email@gmail.com
```

Замените `ваш-пароль-приложения` на пароль, полученный на предыдущем шаге и `ваш-email@gmail.com` на ваш адрес электронной почты.

Для полной настройки всех переменных окружения, пожалуйста, обратитесь к документу [ENV_SETUP.md](ENV_SETUP.md).

### 3. Проверка настроек в application.properties

Убедитесь, что в файле `src/main/resources/application.properties` настроены следующие параметры:

```properties
#Email Configuration
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${EMAIL_USERNAME:erke.bulan622@gmail.com}
spring.mail.password=${EMAIL_APP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.connectiontimeout=5000

#Application Configuration
app.frontend-url=${FRONTEND_URL:http://localhost:3000}
```

Обратите внимание, что теперь используются переменные окружения `${EMAIL_USERNAME}` и `${FRONTEND_URL}` с значениями по умолчанию после двоеточия.

При необходимости измените `spring.mail.username` на ваш адрес электронной почты и `app.frontend-url` на URL вашего фронтенд-приложения.

## Тестирование функциональности сброса пароля

### 1. Запуск приложения

1. Запустите бэкенд-приложение
2. Запустите фронтенд-приложение

### 2. Тестирование процесса сброса пароля

1. Перейдите на страницу входа: `http://localhost:3000/auth/login`
2. Нажмите на ссылку "Забыли пароль?"
3. Введите адрес электронной почты зарегистрированного пользователя
4. Нажмите "Отправить инструкции"
5. Проверьте указанный почтовый ящик на наличие письма с инструкциями по сбросу пароля
6. Перейдите по ссылке из письма
7. Введите новый пароль и подтвердите его
8. Нажмите "Сбросить пароль"
9. Попробуйте войти в систему с новым паролем

## Устранение неполадок

### Письмо не приходит

1. Проверьте папку "Спам" в почтовом ящике
2. Убедитесь, что пароль приложения настроен правильно
3. Проверьте логи приложения на наличие ошибок отправки почты

### Ошибка при сбросе пароля

1. Убедитесь, что токен в URL не был изменен
2. Проверьте, не истек ли срок действия токена (24 часа)
3. Убедитесь, что токен не был использован ранее

## Примечания по безопасности

- Токены сброса пароля действительны в течение 24 часов
- Каждый токен можно использовать только один раз
- При запросе нового токена все предыдущие токены для пользователя удаляются
- Пользователи, вошедшие через Google, не могут сбросить пароль через эту систему
